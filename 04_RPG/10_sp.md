# **10_spber**

**【game.dart】**

プレーヤーと敵の頭上にゲージを表示する

```dart

player1.add(HpBar(
  target: player1,
  barSize: Vector2(70, 10),
  offset: Vector2(0, -PLAYER_SIZE_Y / 2 - 12),
));
// ⭐️追加
player1.add(SpBar(
  target: player1,
  barSize: Vector2(70, 8),
  offset: Vector2(0, -PLAYER_SIZE_Y / 2), // HPのすぐ下あたり
));
player2.add(HpBar(
  target: player2,
  barSize: Vector2(70, 10),
  offset: Vector2(0, -PLAYER_SIZE_Y / 2 - 12),
));
// ⭐️追加
player2.add(SpBar(
  target: player2,
  barSize: Vector2(70, 8),
  offset: Vector2(0, -PLAYER_SIZE_Y / 2),
));

//省略

// ⭐️一番下に追加
abstract class SpProvider {
  int get currentSp;
  int get maxSp;
}

```

**【player.dart】**


```dart

// ⭐️SpProvider追加
class Player extends SpriteComponent
    with HasGameRef<MainGame>, KeyboardHandler
    implements HealthProvider, SpProvider {


  int maxHp = 100;
  int hp = 100;

  // ⭐️追加
  int maxSp = 30;
  int sp = 0;

  @override
  int get currentHp => hp;

  // ⭐️追加
  @override
  int get currentSp => sp;
  

```

**【ui.dart】**


```dart

class SpBar extends PositionComponent {
  SpBar({
    required this.target,
    required this.barSize,
    this.bg = const Color(0xFF333333),
    this.fg = const Color(0xFF3498DB), // 青系の色
    this.borderRadius = 2.0,
    Vector2? offset,
    this.showText = true,
  }) {
    size = barSize;
    position = offset ?? Vector2.zero();
    priority = 1000;
    anchor = Anchor.center;
    _bgPaint.color = bg;
    _fgPaint.color = fg;

    _textPaint = TextPaint(
      style: const TextStyle(
        color: Colors.white,
        fontSize: 10,
        fontFamily: 'monospace',
        shadows: [Shadow(blurRadius: 1, offset: Offset(1, 1))],
      ),
    );
  }

  final SpProvider target;
  final Vector2 barSize;
  final Color bg;
  final Color fg;
  final double borderRadius;
  final bool showText;

  final _bgPaint = Paint();
  final _fgPaint = Paint();
  late final TextPaint _textPaint;

  @override
  void render(Canvas canvas) {
    super.render(canvas);

    // 背景
    final bgRRect = RRect.fromRectAndRadius(
      Rect.fromLTWH(0, 0, barSize.x, barSize.y),
      Radius.circular(borderRadius),
    );
    canvas.drawRRect(bgRRect, _bgPaint);

    // 残量
    final ratio = target.maxSp == 0 ? 0.0 : target.currentSp / target.maxSp;
    final w = (barSize.x * ratio).clamp(0, barSize.x).toDouble();
    final fgRRect = RRect.fromRectAndRadius(
      Rect.fromLTWH(0, 0, w, barSize.y),
      Radius.circular(borderRadius),
    );
    canvas.drawRRect(fgRRect, _fgPaint);

    if (showText) {
      final text = '${target.currentSp} / ${target.maxSp}';
      final textPos = Vector2(barSize.x + 4, barSize.y / 2 - 5);
      _textPaint.render(canvas, text, textPos);
    }
  }
}

```
